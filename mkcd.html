<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MakeCode Game Browser</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f8f8f8;
    }

    input, select {
      padding: 12px;
      font-size: 16px;
      margin: 0 0 20px 0;
      box-sizing: border-box;
    }

    select {
      margin-left: 10px;
    }

    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .card {
      background: white;
      border-radius: 8px;
      padding: 10px;
      width: 200px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.02);
    }

    .card img {
      max-width: 100%;
      border-radius: 6px;
    }

    .title {
      font-weight: bold;
      margin: 10px 0 5px;
    }

    .link {
      display: block;
      margin-top: 5px;
      font-size: 14px;
      color: #0077cc;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>MakeCode Game Browser</h1>
  <div id="count" style="margin-bottom: 20px; font-size: 18px;"></div>

  <input type="text" id="search" placeholder="Search games by name or ID...">
  <select id="filter">
    <option value="any">Any</option>
  </select>

  <div class="grid" id="results"></div>

  <script>
    const filesToLoad = ["games1.json", "games2.json", "games3.json"]; // your actual JSON files here
    const allGames = {};  // key: file name, value: list of games
    let games = [];
    let filtered = [];
    let index = 0;
    const chunkSize = 30;
    let loading = false;

    const searchInput = document.getElementById('search');
    const filterSelect = document.getElementById('filter');
    const countDiv = document.getElementById('count');
    const results = document.getElementById('results');

    // Load all JSONs
    Promise.all(filesToLoad.map(file =>
      fetch(file).then(res => res.json()).then(data => {
        allGames[file] = data;
        const opt = document.createElement("option");
        opt.value = file;
        opt.textContent = file;
        filterSelect.appendChild(opt);
        return data;
      })
    )).then(data => {
      games = data.flat();
      filtered = games;
      index = 0;
      updateCount();
      displayNextChunk();
    });

    // Update displayed count
    function updateCount() {
      countDiv.textContent = `This collection contains ${filtered.length} games`;
    }

    // Show a chunk
    function displayNextChunk() {
      if (loading) return;
      loading = true;

      const next = filtered.slice(index, index + chunkSize);
      next.forEach(game => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <img src="${game.thumb}" alt="${game.name}">
          <div class="title">${game.name}</div>
          <a class="link" href="https://arcade.makecode.com/${game.id}" target="_blank">Play</a>
        `;
        results.appendChild(div);
      });

      index += chunkSize;
      loading = false;
    }

    // Handle filtering and search
    function applyFilters() {
      const term = searchInput.value.toLowerCase();
      const fileFilter = filterSelect.value;

      let base = [];

      if (fileFilter === "any") {
        base = Object.values(allGames).flat();
      } else {
        base = allGames[fileFilter] || [];
      }

      filtered = base
        .map(g => ({
          ...g,
          score: getMatchScore(g, term)
        }))
        .filter(g => g.score > 0)
        .sort((a, b) => b.score - a.score);

      index = 0;
      results.innerHTML = "";
      updateCount();
      displayNextChunk();
    }

    // Search score
    function getMatchScore(game, term) {
      if (!term) return 1;
      const name = game.name?.toLowerCase() || '';
      const id = game.id?.toLowerCase() || '';
      let score = 0;
      if (name.includes(term)) score += 2;
      if (name.startsWith(term)) score += 3;
      if (id.includes(term)) score += 1;
      return score;
    }

    // Scroll to load more
    window.addEventListener('scroll', () => {
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
        displayNextChunk();
      }
    });

    // Search and filter events
    searchInput.addEventListener('input', applyFilters);
    filterSelect.addEventListener('change', applyFilters);
  </script>
</body>
</html>
